<!DOCTYPE html>
<html>
<head>
  <title>Change Password</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <header>
    <a href="{{ url_for('welcome') }}">
    <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo" alt="Logo">
    </a>
    <nav>
      <a href="{{ url_for('logout') }}" class="btn">Logout</a>
      <a href="{{ url_for('student_dashboard') if user.role == 'student' else url_for('technician_dashboard') }}" class="btn">Dashboard</a>
    </nav>
  </header>
  <div class="container login-container">
    <h2>Change Password</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <div class="card-form">
      <form method="POST" id="changePassword">
        <label for="old_password">Current Password:</label>
        <input type="password" name="old_password" id="old_password" required>
        <label for="new_password">New Password:</label>
        <input type="password" name="new_password" id="new_password" required>
        <label for="confirm_password">Confirm New Password:</label>
        <input type="password" name="confirm_password" id="confirm_password" required>
        <button type="submit">Change Password</button>
      </form>
    </div>
  </div>

  <p id="passwordError" style="color:red;"></p>

<script>
document.getElementById("changePassword").addEventListener("submit", function(e) {
    const password = document.getElementById("password").value;
    const confirm = document.getElementById("confirm_password").value;
    const errorMsg = document.getElementById("passwordError");

    // Password and confirm match check
    if (password !== confirm) {
        e.preventDefault();
        errorMsg.textContent = "Passwords do not match!";
        return;
    }

    // Client-side password complexity check
    const pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    if (!pattern.test(password)) {
        e.preventDefault();
        errorMsg.textContent = "Password must be at least 8 characters and include uppercase, lowercase, number, and special character.";
        return;
    }

    errorMsg.textContent = "";
});
</script>
    <footer>
  <div class="footer-content">
    <p>&copy; {{ current_year }} Ensign College &amp; BYU-Idaho Student Help Desk</p>
    <p>
      <a href="{{ url_for('welcome') }}">Home</a> |
      <a href="{{ url_for('change_password') }}">Change Password</a> |
      <a href="{{ url_for('logout') }}">Logout</a>
    </p>
    <p class="small-text">Need assistance? Contact us at <a href="sydrick.bloom@gmail.com">sydrick.bloom@gmail.com</a></p>
  </div>
</footer>
</body>
</html>