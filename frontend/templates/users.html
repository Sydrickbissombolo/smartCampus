<!DOCTYPE html>
<html>
<head>
  <title>Registered Users</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <header>
    <a href="{{ url_for('welcome') }}">
    <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo" alt="Logo">
    </a>
    <nav>
      <a href="{{ url_for('logout') }}" class="btn">Logout</a>
      <a href="{{ url_for('change_password') }}" class="btn">Change Password</a>
      <a href="{{ url_for('technician_dashboard') }}" class="btn">Dashboard</a>
      <a href="{{ url_for('welcome') }}" class="btn">Home</a>
    </nav>
  </header>
  <div class="container-registered-users">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
    {% endwith %}
    <h2>Registered Users</h2>
    <!-- Search box -->
    <form method="GET" action="{{ url_for('search_users') }}" style="margin-bottom:20px;">
      <input type="text" name="q" placeholder="Search username" value="{{ query if query is defined else '' }}">
      <button type="submit" class="btn">Search</button>
    </form>
    <table class="user-table">
      <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Role</th>
            <th style="min-width: 140px;">Actions</th>
            <th style="min-width: 220px;">Reset Password</th>
        </tr>
  </thead>
      <tbody>
        {% for u in users %}
    <tr>
      <td>{{ u.id }}</td>
      <td>{{ u.username }}</td>
      <td>{{ u.role }}</td>
      <td>
        <div class="user-actions">
          <a href="{{ url_for('edit_user', user_id=u.id) }}" class="btn">Edit</a>
          <form method="POST" action="{{ url_for('delete_user', user_id=u.id) }}" style="display:inline;">
            <button type="submit" class="btn" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
          </form>
        </div>
      </td>
      <td>
        <form method="POST" action="{{ url_for('reset_user_password', user_id=u.id) }}" class="user-reset-form">
          <input type="text" name="new_password" placeholder="New password" required>
          <button type="submit" class="btn">Reset</button>
        </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <!-- Pagination controls -->
    <div style="margin-top:20px;">
      {% if page > 1 %}
        <a href="{{ url_for('users', page=page-1) }}" class="btn">Previous</a>
      {% endif %}
      {% if page * per_page < total %}
        <a href="{{ url_for('users', page=page+1) }}" class="btn">Next</a>
      {% endif %}
    </div>
    </div>

    <footer>
  <div class="footer-content">
    <p>&copy; {{ current_year }} Ensign College &amp; BYU-Idaho Student Help Desk</p>
    <p>
      <a href="{{ url_for('welcome') }}">Home</a> |
      <a href="{{ url_for('change_password') }}">Change Password</a> |
      <a href="{{ url_for('logout') }}">Logout</a>
    </p>
    <p class="small-text">Need assistance? Contact us at <a href="mailto:sydrick.bloom@gmail.com">sydrick.bloom@gmail.com</a></p>
  </div>
</footer>
</body>
</html>