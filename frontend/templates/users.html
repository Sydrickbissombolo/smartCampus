<!DOCTYPE html>
<html>
<head>
  <title>Registered Users</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo" alt="Logo">
    <nav>
      <a href="{{ url_for('logout') }}" class="btn">Logout</a>
      <a href="{{ url_for('change_password') }}" class="btn">Change Password</a>
      <a href="{{ url_for('technician_dashboard') }}" class="btn">Dashboard</a>
      <a href="{{ url_for('welcome') }}" class="btn">Home</a>
    </nav>
  </header>
  <div class="container">
    <h2>Registered Users</h2>
    <!-- Search box -->
    <form method="GET" action="{{ url_for('search_users') }}" style="margin-bottom:20px;">
      <input type="text" name="q" placeholder="Search username" value="{{ query if query is defined else '' }}">
      <button type="submit" class="btn">Search</button>
    </form>
    <table style="width:100%;border-collapse:collapse;">
      <thead>
        <tr style="background:#294936;color:#fdb913;">
          <th>ID</th>
          <th>Username</th>
          <th>Role</th>
          <th>Actions</th>
          <th>Reset Password</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr style="background:#f4f8fb;">
          <td>{{ u.id }}</td>
          <td>{{ u.username }}</td>
          <td>{{ u.role }}</td>
          <td>
            <a href="{{ url_for('edit_user', user_id=u.id) }}" class="btn">Edit</a>
            <form method="POST" action="{{ url_for('delete_user', user_id=u.id) }}" style="display:inline;">
              <button type="submit" class="btn" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
            </form>
          </td>
          <td>
            <form method="POST" action="{{ url_for('reset_user_password', user_id=u.id) }}" style="display:inline;">
              <input type="text" name="new_password" placeholder="New password" required>
              <button type="submit" class="btn">Reset</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <!-- Pagination controls -->
    <div style="margin-top:20px;">
      {% if page > 1 %}
        <a href="{{ url_for('users', page=page-1) }}" class="btn">Previous</a>
      {% endif %}
      {% if page * per_page < total %}
        <a href="{{ url_for('users', page=page+1) }}" class="btn">Next</a>
      {% endif %}
    </div>
    </div>
</body>
</html>